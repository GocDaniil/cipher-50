<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Шифратор / Дешифратор</title>
  <link rel="stylesheet" href="style.css"/>
  <!-- Подключаем Pyodide обычным script -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
</head>
<body>
  <div class="theme-toggle-wrapper">
  <button id="themeToggle" class="theme-toggle" aria-label="Переключить тему">
    <!-- Контур луны -->
    <svg id="iconMoon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>
    </svg>
    <!-- Контур солнца -->
    <svg id="iconSun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="display: none;">
      <circle cx="12" cy="12" r="5"/>
      <g>
        <line x1="12" y1="1" x2="12" y2="3"/>
        <line x1="12" y1="21" x2="12" y2="23"/>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
        <line x1="1" y1="12" x2="3" y2="12"/>
        <line x1="21" y1="12" x2="23" y2="12"/>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
      </g>
    </svg>
  </button>
</div>



  <div class="container">
    <input id="inputText" placeholder="Введите текст" />
    <div class="button-row">
      <button id="encryptBtn">Шифровать</button>
      <button id="decryptBtn">Расшифровать</button>
    </div>
    <textarea id="outputText" class="output-field" readonly></textarea>
    <div id="copyTooltip" class="copy-tooltip">Скопировано!</div>
  </div>

  <script>
    let pyodide = null;
    (async () => {
      pyodide = await loadPyodide();  // глобальная функция
      
      // Загружаем Python-файлы
      const [cipherCode, decryptCode] = await Promise.all([
        fetch("Cipher.py").then(r => r.text()),
        fetch("DecryptText.py").then(r => r.text())
      ]);

      try {
        await pyodide.runPythonAsync(cipherCode);
      } catch (e) {
        console.error("Ошибка при загрузке Cipher.py:", e);
      }

      try {
        await pyodide.runPythonAsync(decryptCode);
      } catch (e) {
        console.error("Ошибка при загрузке DecryptText.py:", e);
}
    })();

    async function encrypt() {
      const s = document.getElementById("inputText").value.replace(/"/g,'\\"');
      const code = `c = Cipher("""${s}"""); c.encrypt()`;
      const result = await pyodide.runPythonAsync(code);
      document.getElementById("outputText").value = result;
    }

    async function decrypt() {
  const s = document.getElementById("inputText").value;
  pyodide.globals.set("cipher_input", s);
  try {
    const result = await pyodide.runPythonAsync(`decrypt_main(cipher_input)`);
    console.log("Результат расшифровки:", result);
    document.getElementById("outputText").value = result ?? "Нет результата";
  } catch (e) {
    console.error("Ошибка при расшифровке:", e);
    document.getElementById("outputText").value = "Ошибка: " + e;
  }
}


    document.getElementById("encryptBtn").onclick = encrypt;
    document.getElementById("decryptBtn").onclick = decrypt;

    document.getElementById("outputText").addEventListener("click", function () {
      navigator.clipboard.writeText(this.value);
      const tooltip = document.getElementById("copyTooltip");
      tooltip.classList.add("show");
      setTimeout(() => {
        tooltip.classList.remove("show");
      }, 1500);
    });

    const themeToggle = document.getElementById('themeToggle');
    const iconMoon    = document.getElementById('iconMoon');
    const iconSun     = document.getElementById('iconSun');

    // при загрузке, если тема — тёмная, сразу показываем солнце
    if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-theme');
        iconMoon.style.display = 'none';
        iconSun.style.display  = 'block';
}

    themeToggle.addEventListener('click', () => {
      const isDark = document.body.classList.toggle('dark-theme');
      // SVG
      iconMoon.style.display = isDark ? 'none'  : 'block';
      iconSun.style.display  = isDark ? 'block' : 'none';
      // сохраняем выбор
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
});



  </script>
</body>
</html>
